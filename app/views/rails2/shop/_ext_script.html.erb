<script type="text/javascript">
    
     var areamap = <%=@ad.to_json%>;
     var areacache = new Array();
     function loadgmap() {
      areachange($("area").value);
      <%if (@shop != nil) then%>

      var myOptions = {
        zoom: <%=@shop.zoom if @shop%>,
        center: new google.maps.LatLng(<%=@shop.lat if @shop%>,<%=@shop.lng if @shop%>),
        mapTypeId: google.maps.MapTypeId.ROADMAP
      };
      var map = new google.maps.Map(document.getElementById("map"), myOptions);
      var marker = new google.maps.Marker({
          position: map.getCenter(),
          map: map,
          title: '<%=@shop.name if @shop%>'
      });
      <%end%>
    }

    function f(val){
        if(areacache[val] == null){
            areacache[val] = document.getElementById(val);
        }
        return areacache[val];
    }
    function areachange(val){
        areamap["all"].each(function(value){
            f("t" + value).style.display = "none";
        });
        var oe = true;
        if(val != "all"){
          areamap[val].each(function(value){
              var tgt = f("t" + value);
              tgt.style.backgroundColor = oe ? "#FFEAEA" : "#FAFAFA";
              tgt.style.display = "block";
              oe = !oe;
          });
        }
    }

  function sch(){
    new Ajax.Request(
      "/shop/search",
      {method:"get",parameters:"address="+$("addr").value,onComplete:showRes}
    );
    return false;
  }
  function showRes(oreq){
      var searchResult = [];
      try{
          var searchResult = eval(oreq.responseText);      
      }catch(exp){
          
      }
      if(searchResult.length == 0){
          alert("該当店舗は見つかりませんでした。");
          return;
      }
      areamap["all"].each(function(value){
          $("t" + value).style.display = "none";
      });
      var oe = true;
      searchResult.each(function(value){
          var tgt = f("t" + value);
          tgt.style.backgroundColor = oe ? "#FFEAEA" : "#FAFAFA";
          tgt.style.display = "block";
          
          oe = !oe;
      });
  }
</script>
